# BD-Project

Проект выполнил: Мальцев Сергей

База данных для сервиса доставки продуктов

Все нужные для базы данных SQL скрипты хранятся в папке Scripts:
- *Create.sql* - скрипт для создания базы
- *Insert.sql* - скрипт для вставки тестировочных данных
- *Queries.sql* - скрипт с самыми различными запросами

### Таблицы:
- *users* - Пользователи
- *shopping_carts* - Корзины товаров
- *cart_goods* - Товары внутри корзин
- *goods* - Сами товары
- *categories* - Категории товаров
- *orders* - Заказы
- *delivery_agents* - Доставщики
- *delivery_vehicle* - Транспорт доставки
- *delivery_vehicle_log* - Информация об использовании транспорта

## Концептуальная модель
![image](https://github.com/user-attachments/assets/95d1a870-0513-4c96-8f39-bf9d0bef156c)


## Логическая модель
![image](https://github.com/user-attachments/assets/4a5cbc3e-e516-406e-ba91-04a32d8f350b)



### Нормальная форма:
Все таблицы (кроме users имеющую 3NF) имеют 2NF в связи с использованием суррогатных ключей:
- categories - не кому быть естественным ключом
- goods - есть атрибут *name*, который в теории может принимать неуникальные значения, как мне кажется лучше создать суррогатный ключ
- cart_goods - не удобный естественный ключ (shopping_cart_id, good_id)
- shopping_carts - нечему быть ключом... (связующая таблица)
- order - нет естественного ключа, ведь можно сделать несколько одинаковых заказов у которых все атрибуты идентичны
- delivery_agent - не уникальный ключ, если добавлять поля для уникальности (даты рождения, документы) то слишком большой естественный ключ
- delivery_vehicle_log - нечему быть естественным ключом
- delivery_vehicle - опять нечему быть естественным ключом

Выбран тип SCD 2 для таблицы *delivery_vehicle_log*. Выбран такой тип, потому что нам надо хранить период использования транспорта

### users

| Поле | Доп. Описание | Тип |
|---|---|---|
| *account_name* | ... | VARCHAR(30) |
| *email* | Указываются при регистрации | VARCHAR(200) |
| *phone_number* | Указываются при регистрации | VARCHAR(15) |
| *bonus_credits* | Бонусные баллы, ими можно оплачивать часть покупки (1 балл == 1 руб) | INT |

### shopping_carts

| Поле | Доп. Описание | Тип |
|---|---|---|
| *shopping_cart_id* | ... | SERIAL |
| *user_name* | ... | INT |
| *active* | Активна ли корзина. Активная корзина, в которую пользователь добавляет товары, но как делает заказ эта корзина становится скрытой, ведь orders ссылается на shopping_carts и удалить корзину можно будет только после окончания заказа | BOOL |

### cart_goods

| Поле | Доп. Описание | Тип |
|---|---|---|
| *cart_goods_id* | ... | SERIAL |
| *shopping_cart_id* | ... | INT |
| *good_id* | ... | INT |
| *price_with_discount* | Цена вместе со скидками, ведь могут быть отдельные скидки при покупке определённых сочетаний товаров | INT |
| *amount* | Количество одинаковых товаров | INT |

### goods

| Поле | Доп. Описание | Тип |
|---|---|---|
| *good_id* | ... | SERIAL |
| *category_id* | ... | INT |
| *price* | ... | INT |
| *amount_in_stock* | Кол-во товара на "складе" | INT |

### categories

| Поле | Доп. Описание | Тип |
|---|---|---|
| *category_id* | ... | SERIAL |
| *name* | Категории для группировки товаров и создания скидок по определённым категориям | VARCHAR(30) |

### order

| Поле | Доп. Описание | Тип |
|---|---|---|
| *order_id* | ... | SERIAL |
| *shopping_cart_id* | ... | INT |
| *agent_id* | ... | INT |
| *delivery_address* | Адрес доставки | VARCHAR(200) |
| *total_price* | Финальная цена со всеми скидками и потраченными бонусами | INT |
| *spent_bonus_credits* | Потраченные пользователем бонусы (надо ли?) | INT |

### delivery_agent

| Поле | Доп. Описание | Тип |
|---|---|---|
| *agent_id* | ... | SERIAL |
| *vehicle_id* | У доставщика может быть свой транспорт либо он пеший, поэтому поле может принимать значение NULL | INT |
| *name* | ... | VARCHAR(30) |
| *surname* | ... | VARCHAR(30) |
| *active* | Работает ли в данный момент доставщик (свободный график к примеру) | BOOL |

### delivery_vehicle

| Поле | Доп. Описание | Тип |
|---|---|---|
| *delivery_id* | ... | SERIAL |
| *vehicle* | Сам транспорт (машина, велосипед, самокат) | VARCHAR(30) |
| *vacant* | Использует ли кто-то из доставщиков этот транспорт в данный момент | BOOL |
| *storage_adress* | Адрес хранения транспорта (куда возвращать после работы, или смене транспорта) | VARCHAR(200) |

### delivery_vehicle_log

| Поле | Доп. Описание | Тип |
|---|---|---|
| *id* | ... | SERIAL |
| *vehicle_id* | ... | INT |
| *agent_id* | ... | INT |
| *time_start* | Время начала использования | TIMESTAMP |
| *time_stop* | Время окончания использования (Null если все ещё) | TIMESTAMP |
